# 시스템 아키텍처

## 개요

이 문서는 Claude Code CLI 멀티에이전트 오케스트레이션 시스템의 아키텍처를 설명합니다.

## 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          사용자 인터페이스                                │
│                  (Claude Code CLI / 슬래시 커맨드)                       │
└────────────────────────────────┬────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                       매니저 에이전트 (Opus 4)                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 역할: 작업 분해, 에이전트 할당, 진행 관리, 결과 통합                  │   │
│  │ 도구: Task, Read, Write, Edit, Glob, Grep                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────┬────────────────────────────────────────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│    기획팀        │    │     개발팀       │    │     품질팀       │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • 리서처        │    │ • 백엔드 개발자  │    │ • 코드 리뷰어    │
│ • 아키텍트      │    │ • 프론트엔드     │    │ • 테스터        │
│ • 디자이너      │    │ • 모바일 개발자  │    │ • 보안 감사자    │
│                 │    │ • DevOps        │    │                 │
└────────┬────────┘    └────────┬────────┘    └────────┬────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         공유 상태 레이어                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   태스크     │  │  체크포인트  │  │   산출물    │  │   에이전트   │    │
│  │    큐       │  │    저장소    │  │   저장소    │  │   상태      │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                    state/ 디렉토리 기반 파일 시스템                       │
└─────────────────────────────────────────────────────────────────────────┘
```

## 핵심 원칙

### 1. 중앙 집중식 오케스트레이션
매니저 에이전트가 전체 작업 흐름을 조율합니다.
- 작업 분해 및 의존성 분석
- 적절한 에이전트에게 작업 할당
- 진행 상황 모니터링 및 조정

### 2. 전문화된 역할
각 에이전트는 특정 도메인에 특화되어 있습니다.
- 기획팀: 조사, 설계, UI/UX
- 개발팀: 백엔드, 프론트엔드, 모바일, DevOps
- 품질팀: 리뷰, 테스트, 보안

### 3. 파일 기반 통신
에이전트 간 통신은 파일 시스템을 통해 이루어집니다.
- `state/project-state.json`: 전체 프로젝트 상태
- `state/task-queue.json`: 작업 대기열
- `state/agents/`: 에이전트별 상태

### 4. 병렬 실행
의존성 없는 작업은 동시에 실행됩니다.
- 최대 10개 동시 실행
- 배치 단위 완료 후 다음 배치 시작

## 디렉토리 구조

```
.
├── .claude/                    # Claude Code 설정
│   ├── agents/                 # 에이전트 정의 (11개)
│   │   ├── manager.md
│   │   ├── researcher.md
│   │   ├── architect.md
│   │   ├── designer.md
│   │   ├── backend-dev.md
│   │   ├── frontend-dev.md
│   │   ├── mobile-dev.md
│   │   ├── code-reviewer.md
│   │   ├── tester.md
│   │   ├── security-auditor.md
│   │   └── devops.md
│   ├── commands/               # 슬래시 커맨드
│   │   ├── project/
│   │   ├── feature/
│   │   ├── review/
│   │   ├── test/
│   │   ├── docs/
│   │   └── git/
│   ├── skills/                 # 스킬 정의
│   └── settings.json           # 권한 설정
├── state/                      # 상태 관리
│   ├── project-state.json
│   ├── task-queue.json
│   ├── agents/
│   ├── checkpoints/
│   └── outputs/
├── docs/                       # 프로젝트 문서
├── scripts/                    # 자동화 스크립트
├── templates/                  # 템플릿
├── CLAUDE.md                   # 프로젝트 메모리
└── .gitignore
```

## 작업 흐름

### 기능 구현 워크플로우

```
Phase 1: 기획 (병렬)
┌──────────┐  ┌──────────┐  ┌──────────┐
│ 리서처    │  │ 아키텍트  │  │ 디자이너  │
│ 기술 조사 │  │ 시스템 설계│  │ UI/UX    │
└────┬─────┘  └────┬─────┘  └────┬─────┘
     └─────────────┼─────────────┘
                   ▼
            계획 통합 및 검토

Phase 2: 구현 (병렬)
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ 백엔드 개발자  │  │ 프론트엔드    │  │ 모바일       │
│ API 구현      │  │ UI 구현       │  │ 앱 구현      │
└──────────────┘  └──────────────┘  └──────────────┘

Phase 3: 검증 (병렬)
┌──────────────┐  ┌──────────┐  ┌──────────────┐
│ 코드 리뷰어   │  │ 테스터    │  │ 보안 감사자   │
│ 품질 검토    │  │ 테스트    │  │ 보안 점검    │
└──────────────┘  └──────────┘  └──────────────┘

Phase 4: 배포
┌──────────────┐
│ DevOps       │
│ CI/CD 및 배포 │
└──────────────┘
```

## 모델 선택 전략

| 모델 | 용도 | 비용 |
|------|------|------|
| Opus 4 | 매니저, 아키텍트 (복잡한 추론) | 높음 |
| Sonnet 4 | 대부분의 에이전트 (일반 작업) | 중간 |
| Haiku 3.5 | 테스터, 간단한 커맨드 (빠른 작업) | 낮음 |

## 제약 사항

| 제약 | 설명 |
|------|------|
| 중첩 서브에이전트 불가 | 서브에이전트는 다른 서브에이전트 스폰 불가 |
| 최대 10개 동시 실행 | 추가 태스크는 큐잉 |
| 컨텍스트 격리 | 에이전트 간 직접 통신 불가 (파일 통해서만) |

## 변경 이력

| 날짜 | 변경 내용 | 작성자 |
|------|----------|--------|
| 2024-01-15 | 초기 문서 작성 | AI Agent |
